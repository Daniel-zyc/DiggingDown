# 游戏介绍

## 游戏名称

Digging Down

## 游戏开发及运行环境

python: 3.11.4
pygame: 2.5.1
PIL: 10.0.0
imageio: 2.31.2

## 游戏开发人员

Daniel-zyc
Mouxy
Yooo_fan

## 游戏操作说明

除结束CG界面的按钮不可点击外，其余按钮均可点击。
为方便键盘操作，游戏中空格键（SPACE）也会被识别为回车（ENTER），用来表示确认、继续等。
退出键（ESC）用来表示取消、暂停或者退出等。
数字键 1~9 + 0 用来表示选项 1~9 + 10。
大部分选项都可以使用数字键来快速选择，无需点击。
游戏界面中，WASD与上下左右都可以控制上下左右。
在游戏界面，I、J、K按键可以用来显示游戏信息、游戏档案、游戏按键信息。
E键可以用来开关NPC提示栏，F键用来开关携带矿物提示栏，C键用来开启自动返回（再次点击可以取消）。
在开启自动返回时按下任何方向键都会取消自动返回。

## 游戏存档与档案

游戏存档会被保存在游戏文件夹的.log文件下，游戏档案会被保存在游戏文件夹achieve文件中。
删除存档可以直接通过进入.log文件夹，删除对应存档号的文件夹即可。

## 游戏参数说明与自定义

游戏中部分参数可以自己设定，但是会有一些限制，否则会产生bug。
参数在Constant.py文件中。

### 矿物参数

推荐通过修改K值来调整矿物，也可以直接修改 BLK_DATA 中的数值。

```python
# 矿物可调系数
ORE_SZ_K = [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]    # 单片矿物大小系数
ORE_NUM_K = [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]   # 矿物片数系数
ORE_VAL_K = [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]   # 矿物价值系数
ORE_MINSZ_K = [50, 100]                                                       # 矿物片最小比例
ORE_GROW_K = [30, 100]                                                        # 随机生成矿物时的生长速度
CHEST_NUM_K = [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]             # 宝箱数量系数
CHEST_VAL_K = [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]             # 宝箱价值系数
```

### 迷雾半径

以矿车为中心的迷雾的半径（曼哈顿距离）。
**注意：半径不要超过屏幕最短边的一半。**

```python
FOG_RAD = 5
```

### 背景相关参数

可以自定义背景的生成与移动。
**注意：背景越多，游戏越卡。**

```python
# 云层、鸟的移动速度范围
CLD_SPD = [1, 5]
BIRD_SPD = [1, 5]
# 云层、鸟的生成概率 [分子, 分母]
CLD_GEN_SPD = [1, 300]
BIRD_GEN_SPD = [1, 100]
# 云层、鸟、树最大密度    总数 = NUM_MAX * MAP_M / DENS_LEN
BG_DENS_LEN = 1000
CLD_NUM_MAX, BIRD_NUM_MAX, TREE_NUM_MAX = 100, 100, 100
```

### 钻机参数与升级花费

从上到下依次是：钻头硬度，血量，燃气量，燃油量，矿物容量，引擎速度加成。

```python
DRILL_DATA = {
    'rgd': [3, 6, 9, 12, 15, 18, 21],
    'h_max': [200, 400, 700, 1000, 1500, 3000, 5000],
    'g_max': [100, 150, 250, 400, 700, 1000, 1500],
    'p_max': [10000, 15000, 25000, 40000, 70000, 100000, 150000],
    'o_max': [50, 75, 110, 150, 200, 250, 300],
    'eng': [0, 1, 2, 3, 4, 5, 6],
}
DRILL_COST = {
    'rgd': [100, 200, 300, 400, 500, 600],
    'h_max': [102, 200, 300, 400, 500, 600],
    'g_max': [104, 200, 300, 400, 500, 600],
    'p_max': [103, 200, 300, 400, 500, 600],
    'o_max': [105, 200, 300, 400, 500, 600],
    'eng': [101, 200, 300, 400, 500, 600],
}
```

### 地图行数与列数

可以自定以地图的大小。
**注意：游戏地图过大会导致游戏加载卡顿严重。**
推荐大小在 **1000行** **1000列** 以下。

```python
MAP_N, MAP_M = 101, 101
```

### 矿车移动速度等级

可以根据需要设置矿车的移动速度等级。
**注意：速度不能大于24像素每帧，分母太大会产生卡顿感。**

```python
# 钻机速度 [分子, 分母] 像素每帧
SPEED_LEVEL = [
    [[0, -1], [1, 4], [1, 3], [1, 2], [1, 1], [2, 1], [3, 1], [4, 1], [6, 1], [12, 1]],
    [[0, -1], [1, 2], [2, 3], [1, 1], [2, 1], [4, 1], [6, 1], [8, 1], [12, 1], [24, 1]]
]
```

### 获取速度等级函数

可以自定矿车移动时的获取速度函数。
传递的四个参数分别为：
|变量名|含义|值类型和范围|
|---|---|---|
|blk_tp|目标物块类型|BLK_DATA 中的 key 值与 EMPTY|
|dr_rgd_l|矿车钻头硬度等级|0 到 6|
|dr_eng_l|矿车引擎等级|0 到 6|
|speedup|矿车是否加速|0 或 1|

```python
def get_speed_level(blk_tp, dr_rgd_l, dr_eng_l, speedup):
    # return SPEED_LEVEL[speedup][9]
    dr_rgd = DRILL_DATA['rgd'][dr_rgd_l]
    dr_eng = DRILL_DATA['eng'][dr_eng_l]
    tmp = 4
    if is_dirt(blk_tp) or is_ore(blk_tp) or is_chest(blk_tp):
        blk_rgd = BLK_DATA[blk_tp]['rgd']
        tmp = min(dr_rgd - blk_rgd, tmp)
    if tmp < 0:
        drill_rgd_not_enough_sound.play()
        return SPEED_LEVEL[speedup][0]
    tmp += dr_eng + 1
    tmp = min(tmp, SPEED_LEVEL_MAX)
    return SPEED_LEVEL[speedup][tmp]
```

### 屏幕大小

程序本身会根据使用者屏幕大小做出一定调整。
同时也支持自定大小。
**注意：屏幕大小不能大于地图大小，较小的屏幕会导致提示栏显示不全。**

```python
SCR_N, SCR_M = 45, 79
if SCR_INFO.current_h < 1440 or SCR_INFO.current_w < 2560:
    SCR_N, SCR_M = 37, 65
if SCR_INFO.current_h < 1080 or SCR_INFO.current_w < 1920:
    SCR_N, SCR_M = 29, 53
if SCR_INFO.current_h < 900 or SCR_INFO.current_w < 1600:
    SCR_N, SCR_M = 25, 45
# SCR_N, SCR_M = 45, 79    # 推荐直接修改这里
```

## 注意事项

1. 请务必保证存档和读档时的屏幕大小是一致的，否则会出现bug。
2. 游戏时尽量不要打开全部调试信息，会大幅降低帧率。
3. 在部分界面，游戏可能不会响应关闭窗口请求，请退出这些界面之后关闭窗口。

## 可能遇到的问题

### 进入游戏之后使用键盘操作没有相应

检查使用的输入法，推荐使用系统自带的英文输入法，不要使用中文输入法。使用中文输入法无法被正确识别为按键，而会被识别为输入文本。
